https://www.yuque.com/u2278269/gq5x74/gqqv2z

https://www.4async.com/2021/03/2021-03-11-running-dapr-without-container/

# dapr入门

文档：https://docs.dapr.io/zh-hans/getting-started/install-dapr-selfhost/

## 安装 dapr cli

```shell
wget -q https://raw.githubusercontent.com/dapr/cli/master/install/install.sh -O - | /bin/bash

dapr
```



## 初始化 Dapr

```shell
$ dapr init

$ dapr --version
CLI version: 1.3.0
Runtime version: 1.3.0

# 验证容器正在运行
## 请确保镜像为daprio/dapr, openzipkin/zipkin和 redis 的容器都在运行：
$docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS                        PORTS                              NAMES
045555409acb        openzipkin/zipkin   "start-zipkin"           About a minute ago   Up About a minute (healthy)   9410/tcp, 0.0.0.0:9411->9411/tcp   dapr_zipkin
9dd8e61c95df        daprio/dapr:1.3.0   "./placement"            About a minute ago   Up About a minute             0.0.0.0:50005->50005/tcp           dapr_placement
b2544a5524e7        redis               "docker-entrypoint.s…"   2 minutes ago        Up 2 minutes                  0.0.0.0:6379->6379/tcp             dapr_redis


# 在 dapr init时，CLI 还创建了一个默认组件文件夹，其中包括几个 YAML 文件，其中包含state store、elevated 和 zipkin。 Dapr sidecar, 将读取这些文件。 告诉它使用Redis容器进行状态管理和消息传递，以及Zipkin容器来收集跟踪。
$ ls $HOME/.dapr
bin  components  config.yaml

```



## 使用dapr内置的 api

```shell
$ dapr run --app-id myapp --dapr-http-port 3500

$ curl -X POST -H "Content-Type: application/json" -d '[{ "key": "name", "value": "Bruce Wayne"}]' http://localhost:3500/v1.0/state/statestore

$ curl http://localhost:3500/v1.0/state/statestore/name

$ docker exec -it dapr_redis redis-cli
127.0.0.1:6379> keys *
1) "myapp||name"
127.0.0.1:6379> hgetall "myapp||name"
1) "data"
2) "\"Bruce Wayne\""
3) "version"
4) "1"

# 停用
$ dapr stop --app-id myapp
```



## dapr dashboard

```
dapr dashboard

# 浏览器访问
http://10.4.7.71:8080/
```

